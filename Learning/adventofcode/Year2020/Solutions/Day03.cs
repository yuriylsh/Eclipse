using System;
using System.Collections.Generic;
using System.Linq;
using FluentAssertions;
using Xunit;

namespace Solutions
{
    public class Day03
    {
        [Fact]
        public void Part1_ProvideLines()
        {
            var input = new[]
            {
                "..##.......", "#...#...#..", ".#....#..#.", "..#.#...#.#", ".#...##..#.", "..#.##.....", ".#.#.#....#", ".#........#", "#.##...#...", "#...##....#", ".#..#...#.#"
            };

            var result = Day03Solution.GetByMovingRightBy(input, 3).ToArray();

            result.Should().Equal('.', '.', '#', '.', '#', '#', '.', '#', '#', '#', '#');
        }
        
        [Fact]
        public void Part1()
        {
            var input = new[]
            {
                ".#..........#......#..#.....#..","....#.............#.#....#..#..",".....##...###....#..#.......#..",".#....#..#......#........#.....",".#.........###.#..........##...","...............##........#.....","#..#..........#..##..#....#.#..","....#.##....#..#...#.#....#....","...###...#............#.#......","#.........#..#...............#.","#.#...........#...............#","..#.#......#..###.#...#..##....",".....#..#..#..#............#...","......#.......#.....#....##....","#......#...#.......#.#.#.......","...........##.#.............#..",".#.........#..#.####...........","..#...........#....##..........","#...........#.......#..#.#.....",".....##...#.....#..##..#..#....","#.#..........................#.","##.....#..........#.......##..#","....#..#............#.#.#......",".......#.......#..#............","...#.#..........#..#.....#.....",".....#...##..##.....##........#",".#.....#........##............#","..#....#.#...#.....#.##........","........##.....#......##...##..","......#..................#.....","..##......##.....##...##.......","......#..#...##......##........",".#..#..#.#.....................",".#....#.#...#....#.......##...#",".####.#..##...#.#.#....#...#...",".#....#.....#...#..#.........##","...........#.#####.#.#..##..#..",".#......##...#..###.#.#....#...","...#.....#........#..###...#...",".......#................##.#...",".##...#.#..................#...","..#........#....#..........#..#","..#.........#..................","...#.#..........#.#..##........","...#.##..........##...........#","...........#..#........#.......",".#....#.#...........#....#.##..",".#...#..#............#....#.#..","...#..#...#.........####.#.#...","..#...#...........###..#...##.#","......##...#.#.#....##....#....","#..#.#.....##....#.......#...#.",".#.....#.....#..#..##..........","................#.#.#...##.....",".#.....#............#......#...","...#...#..#.#....######.....#..","..#..........##......##.....#..","......#..#.##...#.#............","....#.......#..#...#..#.#......","#......##.#..#........#.....#..","..#.........#..#.........#.....","..#.........##.......#.#.#..##.","...#....##.................#.#.","...#........##.#.......#.##..##","....#.#...#...#....#...........",".........#....##........#......","...#........#..#.......#...#...","#.......#....#...#...........#.",".......#......#...##...........",".#.#......##.#.......#..#...#..",".#.....##.#...#......#..#......","........#.............#.#..#..#","#...........#....#.....#.##.#.#","................#...#........##","#..#.##..#.....#...##.#........","#.....#.#..##......#.#..#..###.","....#...#.....#................","......#...#..##...........#....","......#.........##.#...#......#","#...#.#.....#..#.#..#..#......#","...#.#..#..#.#........###.#....","..#...#.......#.#.......#......","...#....#.....#.......#......#.","#...........#....#..#..#.......","..........##......##.........##","##............#..#.#...#..#.#..","..#.##....##...##..#...#.......","............##.##..###..#..#...","......#....##...##.........#...","......#..#.#......####..#......","..............#....#..#..##....","...#.#..#...##.#.......#.#.....","...#.#....#.......#..#..#..##..","..........#.........#..........","...#.....#............#.....##.","....#.#......................#.",".........#...#.#...#...........","...#........#..##.....#...#.#..","......##.....#.#..#...###.#...#","#....#..#.#.....#...#..........",".#.##.###.........#..##.#....#.","#.........#....#........#...#..","...........#...............#..#","###....................#....#..",".................#....#.....#..","..........#.........#.......#..","........#..#....#.....##.......","#...##.#...#.#.#............#..","....#.........##.#.#..#...###..",".##..............#...#.....##.#","###...#..................#...#.",".....#..#...#..#...#...........",".#.................#...#..#..#.",".#.........###...#.##......###.",".####............#......#..#...","....#........#..#.#....#..##..#","..#....#.#...#.#.....##....#...","..###..#..#....##....#..#..#...","...#.#.....#.#....#.....#......",".....#..........#.#............",".......#...........#.#..#..#...","......##........#.....#.......#","..#.#.....##............#..##..","....#.#........#...........##..","#......#..##........#.....#....","#...#...###..............##....","#..#........#........#.....##.#","......##.####........#..#....#.","...##..#.##.....#...#...#..#...","#..............###.##..##......","......................#.....#..",".........#.#.......#...##.#....","....#......#..........###..#...","#...####.#.................#..#","##.#....#....#.....##..#....#.#","..#.....#..##.........#.#..#.#.",".....#.....#...................","#....##.#.........###....#.....","#........#.#.......#.#.........",".##.#...#.....#...#.......##.##","#..#.............#.............","..........#.........####.......","..##..............#..#.#.......","..#.#.....#........#......##...","#.#.......#.#................#.",".#...#........#....##....#.##..",".#..#...#...#......#.#.........","......##............#.........#",".#....#.#.#.........#..#..##...","#....#......#.......###........",".......#........##..#...#..###.","#.##..........#..###..#..#.#...",".#..#....#..........#.#.##.....","#..#...#.#...#..#..#.#...#.....",".........#...#.#............#..","#..#.............#......##.##..","...##.......#..................","....#......#...#.....#......#..",".....##..#......#....#....#....","....#...#...#...#.....#........",".#....#........##....#..#.#...#","#.......#..#......#......#...#.","..............#......#......#..","#......#..##...#........#....#.","#..#..#..#.....#..#........#...","#...#.....#...#..........#...##","........#.......#...#.....#.#..","...................##.......#..",".#......#........#.##..#....#..",".....#.....#...#..#..#......#..","........##.#..##.........#....#",".........#.......#.............","............#.###.###..#.#.....",".............#....#...........#","..#.....#.#..##.##........#....","...#....#....#.........#.....#.",".#............#......#.........","..#.#..........##.##......#.#..","....#.........................#","..........##...................","#.......#.#..............#...#.","...##..#..##...##.#..#.#.#.....","...########.#..##....#.........","##.#........##.....#........#..","#.#.....#........#..#....#...#.","..#............#.......###.##.#","#.#............................","...#.#.#....#..........#..#....","..###.#.....#.#..#.............","#........#..........#.#..#.....","...........#..#....#.........#.","..#............#.....#.#.......","#.#............#..#.....#.#.#..","...#...#.......................",".#.#.#...##.............#..#..#","..#.........#..#.....##....##..",".#...#............#.......#..##","....#..#.#.#...####............","#.......#....#..##....##....#..",".....##.#....#.#..#.......#....","...........#.......#....##.#.##","..........#...#....##...#.#....","..#.............#.............#","....#..#.....#....#.#..###.#...",".......#.##.#......#...##...#.#",".#..#.#..#.#.......#....###.#..","#..........##...##.........##..","##..#......##.#.####.#.....#...","....#.#...#........#..##..#.#..",".#.............................",".##..#.#...##.....#....#.....#.","..##.........#......#.........#",".#.#........#...#.#.#....##....",".#.................##.........#","...#...............#....#......","..#...#..#..........###..#...##","..........#..#..........##..#..","...#.............#.##.#...#....","...#...........#...............","......#.........##.#...#...#...","...#.#........#..#.....#..#...#","#.#...#....##...#.....#....#...","#.#.#..#.....#.........#.......","##...........#..####...........","#..........#........###...#..#.","#..#.......#....#......###.....","..#.....#......#.###......##...","...#.##..#............#...#....",".##........#.....#.............","#....#.##..#...........##.#.#..","..#.....#.#....#.......#......#","#..#.......#............#......","#.......##....#...#..#.........",".................#..##.........","..............#..#..#.##.......","#.#.......................#..#.","..#..##...........#....#..#..#.","...#....#.......#.......#....#.",".....#.#..#.#.....#.........#.#","..#.#.........#.....#..........","...#.#.#.......#.#.......#.#..#","...##...#.#.#.....#.....##....#","##.......#.#.#.#.......#...##..","....#.#...........#......#.....",".#.....#........####...........","#......#........#.....#..#..#..","..#..#......#...##.......#....#","#........#..........#.....#.#..",".#...........#.....#.....#.....","..........#..#...#....#....##..",".....#.#..........#.....##..#..","......#.........##.............","..#..#.....##......##........#.",".#.#.#.#..#.#..#.......#.......","#.#...####.#.#....#.#........#.","....#...#.....#......#..##.....","##.........#.........#..#.#..#.","..#.#........#.#........#.##...","#....#......#...#....#.........",".##.............###....###.#...","..##.#.......#...#..#......#...",".....#.##..................#...",".....#.#...#..#................","........#..#..#...........#.#.#","....#.###.....#..#.#.....##..##","....##.#.........#..##.........",".##........#......#..###..#.##.",".........##...............#.##.","..#...............#.#...#..#.#.","....#....##.....#...#..#.....#.","#...#.....................#....",".....#.#............#...##.#.#.","...#......#.......#........##.#",".#.#..#.#....#.##.......##....#",".........#...#..##.........#...",".#...#..#....................#.",".......#...#........#.#..#.#.##",".#.............#......#..#.#...","............##.........#....#.#","#.........##..##...............",".#.#....#.#..#..........##.....","..###...#..#.#.......#..#...##.",".....#....#.#............##.#..","##.....#.#..#..#...............","...##...#......#....#..#..#....",".............#....#..#..##...##","#.......#............#....##..#","..#.##.....#.......#....#....#.","..........#...#.............###","..#....#.#..................#..","#.#...#..#...........#.........","....##..#..##..#..........#....","#...#...#.#....#.##...#.......#","#......##.#...##..#.....#......","....#.......#.#............#...","#....#...........###...........","#..#...#...#......#.#..#.......","...............................","#........##.............#.#....",".............#........#....#.##","........##.####.....##..#......","#.#.#.#.......##....##.....#...",".......#..##..#...#............","..........#...#....#..#.#.#.##.","...#........##....#...#........","#..#.##....#....#........#.....",".##...#.....##...#.............",".#...#..#.#.....#.##.....#.....","...........#.............#...#.",".#..#................#...#..#..","#..........#......##..##....#..","####..#...........#.#....#.....","..#.#.##..#...##........#....##",".#.......##........#.....#.....","............#................#.",".#...#...#.....#.#....#.##..#..","..#.............#.#....#.#.....","..............#...........#....","..............#........#....#..","..........##........#..#...#...","...#.#....#.#....#..#.....#...#","..#......#...........#..#..#.#.",".....##.....#.####....#........"
            };

            var result = Day03Solution.GetByMovingRightBy(input, 3).Count(x => x == '#');

            result.Should().Be(247);
        }
        
        [Fact]
        public void Part2()
        {
            var input = new[]
            {
                ".#..........#......#..#.....#..","....#.............#.#....#..#..",".....##...###....#..#.......#..",".#....#..#......#........#.....",".#.........###.#..........##...","...............##........#.....","#..#..........#..##..#....#.#..","....#.##....#..#...#.#....#....","...###...#............#.#......","#.........#..#...............#.","#.#...........#...............#","..#.#......#..###.#...#..##....",".....#..#..#..#............#...","......#.......#.....#....##....","#......#...#.......#.#.#.......","...........##.#.............#..",".#.........#..#.####...........","..#...........#....##..........","#...........#.......#..#.#.....",".....##...#.....#..##..#..#....","#.#..........................#.","##.....#..........#.......##..#","....#..#............#.#.#......",".......#.......#..#............","...#.#..........#..#.....#.....",".....#...##..##.....##........#",".#.....#........##............#","..#....#.#...#.....#.##........","........##.....#......##...##..","......#..................#.....","..##......##.....##...##.......","......#..#...##......##........",".#..#..#.#.....................",".#....#.#...#....#.......##...#",".####.#..##...#.#.#....#...#...",".#....#.....#...#..#.........##","...........#.#####.#.#..##..#..",".#......##...#..###.#.#....#...","...#.....#........#..###...#...",".......#................##.#...",".##...#.#..................#...","..#........#....#..........#..#","..#.........#..................","...#.#..........#.#..##........","...#.##..........##...........#","...........#..#........#.......",".#....#.#...........#....#.##..",".#...#..#............#....#.#..","...#..#...#.........####.#.#...","..#...#...........###..#...##.#","......##...#.#.#....##....#....","#..#.#.....##....#.......#...#.",".#.....#.....#..#..##..........","................#.#.#...##.....",".#.....#............#......#...","...#...#..#.#....######.....#..","..#..........##......##.....#..","......#..#.##...#.#............","....#.......#..#...#..#.#......","#......##.#..#........#.....#..","..#.........#..#.........#.....","..#.........##.......#.#.#..##.","...#....##.................#.#.","...#........##.#.......#.##..##","....#.#...#...#....#...........",".........#....##........#......","...#........#..#.......#...#...","#.......#....#...#...........#.",".......#......#...##...........",".#.#......##.#.......#..#...#..",".#.....##.#...#......#..#......","........#.............#.#..#..#","#...........#....#.....#.##.#.#","................#...#........##","#..#.##..#.....#...##.#........","#.....#.#..##......#.#..#..###.","....#...#.....#................","......#...#..##...........#....","......#.........##.#...#......#","#...#.#.....#..#.#..#..#......#","...#.#..#..#.#........###.#....","..#...#.......#.#.......#......","...#....#.....#.......#......#.","#...........#....#..#..#.......","..........##......##.........##","##............#..#.#...#..#.#..","..#.##....##...##..#...#.......","............##.##..###..#..#...","......#....##...##.........#...","......#..#.#......####..#......","..............#....#..#..##....","...#.#..#...##.#.......#.#.....","...#.#....#.......#..#..#..##..","..........#.........#..........","...#.....#............#.....##.","....#.#......................#.",".........#...#.#...#...........","...#........#..##.....#...#.#..","......##.....#.#..#...###.#...#","#....#..#.#.....#...#..........",".#.##.###.........#..##.#....#.","#.........#....#........#...#..","...........#...............#..#","###....................#....#..",".................#....#.....#..","..........#.........#.......#..","........#..#....#.....##.......","#...##.#...#.#.#............#..","....#.........##.#.#..#...###..",".##..............#...#.....##.#","###...#..................#...#.",".....#..#...#..#...#...........",".#.................#...#..#..#.",".#.........###...#.##......###.",".####............#......#..#...","....#........#..#.#....#..##..#","..#....#.#...#.#.....##....#...","..###..#..#....##....#..#..#...","...#.#.....#.#....#.....#......",".....#..........#.#............",".......#...........#.#..#..#...","......##........#.....#.......#","..#.#.....##............#..##..","....#.#........#...........##..","#......#..##........#.....#....","#...#...###..............##....","#..#........#........#.....##.#","......##.####........#..#....#.","...##..#.##.....#...#...#..#...","#..............###.##..##......","......................#.....#..",".........#.#.......#...##.#....","....#......#..........###..#...","#...####.#.................#..#","##.#....#....#.....##..#....#.#","..#.....#..##.........#.#..#.#.",".....#.....#...................","#....##.#.........###....#.....","#........#.#.......#.#.........",".##.#...#.....#...#.......##.##","#..#.............#.............","..........#.........####.......","..##..............#..#.#.......","..#.#.....#........#......##...","#.#.......#.#................#.",".#...#........#....##....#.##..",".#..#...#...#......#.#.........","......##............#.........#",".#....#.#.#.........#..#..##...","#....#......#.......###........",".......#........##..#...#..###.","#.##..........#..###..#..#.#...",".#..#....#..........#.#.##.....","#..#...#.#...#..#..#.#...#.....",".........#...#.#............#..","#..#.............#......##.##..","...##.......#..................","....#......#...#.....#......#..",".....##..#......#....#....#....","....#...#...#...#.....#........",".#....#........##....#..#.#...#","#.......#..#......#......#...#.","..............#......#......#..","#......#..##...#........#....#.","#..#..#..#.....#..#........#...","#...#.....#...#..........#...##","........#.......#...#.....#.#..","...................##.......#..",".#......#........#.##..#....#..",".....#.....#...#..#..#......#..","........##.#..##.........#....#",".........#.......#.............","............#.###.###..#.#.....",".............#....#...........#","..#.....#.#..##.##........#....","...#....#....#.........#.....#.",".#............#......#.........","..#.#..........##.##......#.#..","....#.........................#","..........##...................","#.......#.#..............#...#.","...##..#..##...##.#..#.#.#.....","...########.#..##....#.........","##.#........##.....#........#..","#.#.....#........#..#....#...#.","..#............#.......###.##.#","#.#............................","...#.#.#....#..........#..#....","..###.#.....#.#..#.............","#........#..........#.#..#.....","...........#..#....#.........#.","..#............#.....#.#.......","#.#............#..#.....#.#.#..","...#...#.......................",".#.#.#...##.............#..#..#","..#.........#..#.....##....##..",".#...#............#.......#..##","....#..#.#.#...####............","#.......#....#..##....##....#..",".....##.#....#.#..#.......#....","...........#.......#....##.#.##","..........#...#....##...#.#....","..#.............#.............#","....#..#.....#....#.#..###.#...",".......#.##.#......#...##...#.#",".#..#.#..#.#.......#....###.#..","#..........##...##.........##..","##..#......##.#.####.#.....#...","....#.#...#........#..##..#.#..",".#.............................",".##..#.#...##.....#....#.....#.","..##.........#......#.........#",".#.#........#...#.#.#....##....",".#.................##.........#","...#...............#....#......","..#...#..#..........###..#...##","..........#..#..........##..#..","...#.............#.##.#...#....","...#...........#...............","......#.........##.#...#...#...","...#.#........#..#.....#..#...#","#.#...#....##...#.....#....#...","#.#.#..#.....#.........#.......","##...........#..####...........","#..........#........###...#..#.","#..#.......#....#......###.....","..#.....#......#.###......##...","...#.##..#............#...#....",".##........#.....#.............","#....#.##..#...........##.#.#..","..#.....#.#....#.......#......#","#..#.......#............#......","#.......##....#...#..#.........",".................#..##.........","..............#..#..#.##.......","#.#.......................#..#.","..#..##...........#....#..#..#.","...#....#.......#.......#....#.",".....#.#..#.#.....#.........#.#","..#.#.........#.....#..........","...#.#.#.......#.#.......#.#..#","...##...#.#.#.....#.....##....#","##.......#.#.#.#.......#...##..","....#.#...........#......#.....",".#.....#........####...........","#......#........#.....#..#..#..","..#..#......#...##.......#....#","#........#..........#.....#.#..",".#...........#.....#.....#.....","..........#..#...#....#....##..",".....#.#..........#.....##..#..","......#.........##.............","..#..#.....##......##........#.",".#.#.#.#..#.#..#.......#.......","#.#...####.#.#....#.#........#.","....#...#.....#......#..##.....","##.........#.........#..#.#..#.","..#.#........#.#........#.##...","#....#......#...#....#.........",".##.............###....###.#...","..##.#.......#...#..#......#...",".....#.##..................#...",".....#.#...#..#................","........#..#..#...........#.#.#","....#.###.....#..#.#.....##..##","....##.#.........#..##.........",".##........#......#..###..#.##.",".........##...............#.##.","..#...............#.#...#..#.#.","....#....##.....#...#..#.....#.","#...#.....................#....",".....#.#............#...##.#.#.","...#......#.......#........##.#",".#.#..#.#....#.##.......##....#",".........#...#..##.........#...",".#...#..#....................#.",".......#...#........#.#..#.#.##",".#.............#......#..#.#...","............##.........#....#.#","#.........##..##...............",".#.#....#.#..#..........##.....","..###...#..#.#.......#..#...##.",".....#....#.#............##.#..","##.....#.#..#..#...............","...##...#......#....#..#..#....",".............#....#..#..##...##","#.......#............#....##..#","..#.##.....#.......#....#....#.","..........#...#.............###","..#....#.#..................#..","#.#...#..#...........#.........","....##..#..##..#..........#....","#...#...#.#....#.##...#.......#","#......##.#...##..#.....#......","....#.......#.#............#...","#....#...........###...........","#..#...#...#......#.#..#.......","...............................","#........##.............#.#....",".............#........#....#.##","........##.####.....##..#......","#.#.#.#.......##....##.....#...",".......#..##..#...#............","..........#...#....#..#.#.#.##.","...#........##....#...#........","#..#.##....#....#........#.....",".##...#.....##...#.............",".#...#..#.#.....#.##.....#.....","...........#.............#...#.",".#..#................#...#..#..","#..........#......##..##....#..","####..#...........#.#....#.....","..#.#.##..#...##........#....##",".#.......##........#.....#.....","............#................#.",".#...#...#.....#.#....#.##..#..","..#.............#.#....#.#.....","..............#...........#....","..............#........#....#..","..........##........#..#...#...","...#.#....#.#....#..#.....#...#","..#......#...........#..#..#.#.",".....##.....#.####....#........"
            };
            // var input = new[]
            // {
            //     "..##.......", "#...#...#..", ".#....#..#.", "..#.#...#.#", ".#...##..#.", "..#.##.....", ".#.#.#....#", ".#........#", "#.##...#...", "#...##....#", ".#..#...#.#"
            // };
            var result = new []{(1, 1), (3, 1), (5, 1), (7, 1), (1, 2)}
                .Select( x =>  Day03Solution.GetByMovingRightBy(input, x.Item1, x.Item2).Count(x => x == '#'));

            result.Should().Equal(78, 247, 68, 69, 33);
        }
    }

    public class Day03Solution
    {
        public static IEnumerable<char> GetByMovingRightBy(IEnumerable<string> input, int moveRightBy, int moveDownBy = 1)
        {
            var currentRight = 0;
            foreach (var line in TakeEvery(input, moveDownBy))
            {
                yield return line[NormalizeIndex(currentRight, line.Length)];
                currentRight += moveRightBy;
            }

            static int NormalizeIndex(int index, int lineLength)
                => index % lineLength;
        }
        
        static IEnumerable<string> TakeEvery(IEnumerable<string> input, int step){	
            var currentStep = 1;
            foreach (var x in input)
            {
                currentStep -= 1;
                if(currentStep == 0){
                    yield return x;
                    currentStep = step;
                }
            }
        }
    }
}